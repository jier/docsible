{% for task_file in role.tasks %}
#### File: tasks/{{ task_file.file }}
{# Check if we need tags/comments columns #}
{% set ns = namespace(has_tags=false, has_comments=false) %}
{% for task in task_file.tasks %}
{% if task_file.mermaid | selectattr('name', 'equalto', task.name) | map(attribute='tags') | list | first %}
{% set ns.has_tags = true %}
{% endif %}
{% endfor %}
{% if task_file.comments | length > 0 %}
  {% set ns.has_comments = true %}
{% endif %}
| Name | Module | Has Conditions |{% if ns.has_tags %} Tags |{% endif %}{% if ns.has_comments %} Comments |{% endif %}
|------|--------|----------------|{% if ns.has_tags %}------|{% endif %}{% if ns.has_comments %}----------|{% endif %}
{% for task in task_file.tasks -%}
{%- set link = links.render_repo_link(role.repository, role.name, 'tasks/' ~ task_file.file, task_file.lines[task.name], role.repository_type, role.repository_branch, role.belongs_to_collection) -%}
| {% if task_file.lines and task_file.lines[task.name] %}[{{ task.name | escape_table_cell }}]({{ link }}){% else %}{{ task.name | escape_table_cell }}{% endif %} | {{ task.module | escape_table_cell }} | {{ 'True' if task.when else 'False' }} |{% if ns.has_tags %} {{ task_file.mermaid | selectattr('name', 'equalto', task.name) | map(attribute='tags') | safe_join(',') }} |{% endif %}{% if ns.has_comments %} {{ task_file.comments | selectattr('task_name', 'equalto', task.name) | map(attribute='task_comments') | safe_join(' ') }} |{% endif %}
{% endfor %}
{% endfor %}
{# Mermaid diagram section with pagination support #}
{% if task_file.mermaid_diagram %}
{% if task_file.mermaid_diagram.paginated %}
{# Large diagram - show paginated version #}
**Task Flow Diagram** ({{ task_file.mermaid_diagram.pages | length }} pages - diagram is large)
{{ get_diagram_complexity_warning(task_file.mermaid_diagram.full_diagram) }}
<details>
<summary>ðŸ“Š View Full Diagram (may not render on all platforms)</summary>
```mermaid
{{ task_file.mermaid_diagram.full_diagram }}