{# Role Complexity Analysis Section #}
{% if include_complexity and complexity_report %}
## Role Complexity Analysis

**Complexity Level:** <span style="color: {% if complexity_report.category.value == 'simple' %}green{% elif complexity_report.category.value == 'medium' %}orange{% else %}red{% endif %}">{{ complexity_report.category.value.upper() }}</span>

### Metrics

| Metric | Value |
|--------|-------|
| Total Tasks | {{ complexity_report.metrics.total_tasks }} |
| Task Files | {{ complexity_report.metrics.task_files }} |
| Handlers | {{ complexity_report.metrics.handlers }} |
| Conditional Tasks | {{ complexity_report.metrics.conditional_tasks }} ({{ "%.0f"|format(complexity_report.metrics.conditional_percentage) }}%) |
| Max Tasks per File | {{ complexity_report.metrics.max_tasks_per_file }} |
| Role Dependencies | {{ complexity_report.metrics.role_dependencies }} |
| Task Includes | {{ complexity_report.metrics.task_includes }} |

{% if complexity_report.integration_points %}
### External Integrations ({{ complexity_report.integration_points|length }})

This role integrates with external systems:

{% for integration in complexity_report.integration_points %}
**{{ loop.index }}. {{ integration.system_name }}** ({{ integration.type.value }})
- **Modules Used:** `{{ integration.modules_used|join('`, `') }}`
- **Tasks Count:** {{ integration.task_count }}
{% if integration.uses_credentials %}- **⚠️ Requires Credentials**{% endif %}

{% endfor %}
{% endif %}

### Composition Score

**Internal Orchestration:** {{ complexity_report.composition_score }} ({{ 'Low' if complexity_report.composition_score < 5 else 'Medium' if complexity_report.composition_score < 15 else 'High' }})
- Role Dependencies: {{ complexity_report.metrics.role_dependencies }}
- Task Includes: {{ complexity_report.metrics.task_includes }}

### Recommendations

{% for recommendation in complexity_report.recommendations %}
- {{ recommendation }}
{% endfor %}

### Visualization Strategy

{% if complexity_report.category.value == 'simple' %}
**For SIMPLE roles** ({{ complexity_report.metrics.total_tasks }} tasks):
- ✅ Sequence diagrams show linear execution flow
- ✅ Task flowcharts show individual task details
{% elif complexity_report.category.value == 'medium' %}
**For MEDIUM roles** ({{ complexity_report.metrics.total_tasks }} tasks):
- ✅ State diagrams show workflow phases
- ✅ Sequence diagrams show detailed execution
- ✅ Component hierarchy shows task organization
{% else %}
**For COMPLEX roles** ({{ complexity_report.metrics.total_tasks }} tasks):
- ✅ Component architecture shows internal structure
- ✅ Phase-based documentation (manual + auto-generated)
- ⚠️ Consider splitting into smaller, focused roles
{% endif %}

---
{% endif %}
